# Segment tree 2 lazy propagation (সেগমেন্ট ট্রি লেজি প্রোপাগেশন)

আমরা [আগের পোস্টে](segment-tree.md) দেখেছি কিভাবে সেগমেন্ট ট্রি দিয়ে সহজেই এবং খুব দ্রুত রেঞ্জ কুয়েরি করা যায় এবং মাঝে যদি আমরা অরিজিনাল অ্যারেটি মডিফাই/আপডেট-ও করি তাও কিন্তু প্রতি কুয়েরি একি সময় সীমার মদ্ধেই রান করে। এখন তোমাকে যদি বলা হয় যে আপডেট করার সময় একটি মাত্র একটি ইন্ডেক্স না দিয়ে একটি রেঞ্জ দেওয়া হবে এবং একটি ভ্যালূ দেওয়া হবে, তোমার ওই রেঞ্জের সব গুলো আইটেম ওই ভ্যালু দিয়ে আপডেট করতে হবে, তাহলে হয়তো তুমি ওই রেঞ্জে লুপ চালিয়ে সব গুলো নোড আপডেট করে নিতে পারো। কিন্তু এরকম বার বার যদি রেঞ্জ উপডেট করতে বলে সেই ক্ষেত্রে এই পদ্ধতিটি অনেক সময় সাপেক্ষ হয়ে যাবে। তো এটার জন্য আমাদের অন্য কিছু চিন্তা করে বের করা দরকার। ঠিক এই টাইপের প্রব্লেম সল্ভ করার যন্যই সেগমেন্ট ট্রি তে আমরা লেজি প্রোপাগেশন ব্যাবহার করতে পারি। লেজি প্রোপাগেশন এর আইডিয়াটা খুবই সহজ - আমরা যখন কোন নোড আপডেট করব তখনি তার সব চাইল্ড নোড গুলো আপডেট না করে কেবল মার্ক করে রাখব, মানে আমরা বলে রাখছি যে ভবিষ্যতে যদি দরকার হয় তখন আপডেটটি অ্যাপ্লাই করে নিব কারন আপাতত আমার চাইল্ড নোড গুলো দরকার হচ্ছে না। তো এরপরের বার যখন ওই চাইল্ড নোডটিকে কুয়েরি বা আপডেট করা হবে, তখন আগেকার আপডেটটি অ্যাপ্লাই করে তারপর কুয়েরি/আপডেট করব। এটি করার কারনে আমাদের চাইল্ড নোড গুলোতে সাথে সাথে গিয়ে আপডেট করা লাগছে না এবং কোন ম্যাচিং রেঞ্জ পেলে সাথে সাথে রিটার্ন করতে পারবো। বুঝতেই পারছ এটি আমাদের অনেক মুল্যবান সময় বাচাবে। ছোট একটি উদাহরণ দি - ধর তোমার অ্যারের সাইজ অনেক বড় 100000, তোমাকে বলা হলো যে প্রথম ইন্ডেক্স থেকে সুরু করে শেষের ইন্ডেক্স পর্যন্ত সবগুলো নম্বরের সাথে 5 যোগ করতে হবে এবং তার রেজাল্ট বলে দিতে হবে। লেজি প্রোপাগেশন অ্যাপ্লাই করে তুমি প্রায় O(1) টাইমেই আপডেট এবং রেজাল্ট দুইই বের করে ফেলতে পারবে যা কিনা লেজি প্রোপাগেশন ছাড়া O(n) সময় লাগতো। এর কারন হলো তোমার প্রতিটি লিফ নোডে গিয়ে গিয়ে আপডেট করা লাগতো। অনেক থিওরি হয়েছে, এখন দেখা যাক ইমপ্লিমেন্টেশন।

লেজি প্রোপাগেশনের ক্ষেত্রে একটি কথা সবসময় মাথায় রাখতে হবে, **প্রতিটি আপডেট কিংবা কুয়েরি করার আগে চেক করতে হবে যে আগে কোন পুরাতন আপডেট পেন্ডিং আছে কিনা। যদি পেন্ডিং আপডেট থাকে তাহলে আগে পুরাতন আপডেট অ্যাপ্লাই করে নিতে হবে**, তারপর আমরা আমাদের কুয়েরি বা আপডেট করব।

প্রথমেই আমাদের এক্সট্রা একটি `lazy[]` অ্যারে লাগবে। এই অ্যারেটি আমাদের আপডেটের তথ্য রাখবে। 
